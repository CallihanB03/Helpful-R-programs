---
title: "HW 7"
author: "SDS322E"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
---

```{r global_options, include=FALSE}
#DO NOT EDIT THIS CHUNK OR ANYTHING ABOVE IT!
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, fig.align = "center", warning = F, message = F, tidy=T, tidy.opts=list(width.cutoff=50), R.options=list(max.print=100,dplyr.print_max=100))
```

## Enter your name and EID here: Callihan Bertley cjb5564

**Please submit as a knitted HTML file on Canvas before the due date**

*For all questions, include the R commands/functions that you used to find your answer. Answers without supporting code will not receive credit.*

> **Review of how to submit this assignment**
> All homework assignments will be completed using R Markdown. These `.Rmd` files consist of text/syntax (formatted using Markdown) alongside embedded R code. 
> When you have completed the assignment (by adding R code inside codeblocks and supporting text outside of the codeblocks), create your document as follows:

> - Click the arrow next to the "Knit" button (above) 
> - Choose "Knit to HTML" and wait; fix any errors if applicable
> - Go to Files pane and put checkmark next to the correct HTML file
> - Click on the blue gear icon ("More") and click Export
> - Download the file and then upload to Canvas

---

### Question 1 (5 pts)

##### Take a look at the `swiss` dataset. It contains measurements of 6 socioecnomic variables for 47 French-speaking Swiss provinces/cantons from 1888. Variables are all recorded on a 0-100 scale and include `Fertility`, `Agriculture` (% in an agricultural occupation), `Examination` (% earning highest honors on army exam), `Education` (% with education beyond primary school), `Catholic` (% Catholic), and `Infant.Mortality` (% of live births surviving less than 1 year).

##### First, create a correlation matrix and visualize it with a correlation heatmap using ggplot2. Include `scale_fill_gradient2()` and label your tiles with the actual correlations using `geom_text(aes(label=...))`. Discuss what you see. Specifically, which variables are strongly positively correlated? Which variables are strongly negatively correlated? Which variable seems to be the least correlated with things like education and agriculture?

```{R}
library(tidyverse)
library(cluster)

head(swiss)

myRound <-function(val){
  roundedVal <- round(val, 2)
  return(roundedVal)
}


swiss %>% 
  select_if(is.numeric) %>% 
  cor %>% as.data.frame %>% 
  rownames_to_column() %>% 
  pivot_longer(-1) %>% 
  ggplot(aes(rowname, name, fill=value)) +
  geom_tile() + 
  geom_text(aes(label=(myRound(value)))) + 
  xlab("") + 
  ylab("") + 
  coord_fixed() + 
  scale_fill_gradient2(low="red", mid="white", high="blue")

```
**Examination and Education, Infant Mortality and Fertility, Catholic and Fertility, and Catholic and Agriculture all have a high positive correlation with respect to the rest of the heatmap. Examination and Agriculture, Agriculture and Education, Fertility and Education, and Examination and Catholic all have a high negative correlation with respect to the rest of the heatmap. Catholic and Infant Mortality seem to be the least correlated with Education while Infant Mortality seems to be the least correlated with Agriculture.**


### Question 2 (9 pts)

Now, using the `swiss` dataset (normalize data first), perform a cluster analysis by (1) choosing the number of clusters that maximizes average silhouette width (try k=2 up to k=10), and (2) running the PAM clustering algorithm on the raw data for that many clusters (save the object as swiss_pam). Show all code for both steps. 

Now, discuss the following: How good is the cluster solution in terms of overall average silhouette width? Which two provinces are the medoids (the representatives of their clusters)? What variables are they most similar on? Most different?

```{R}
sil_width <- numeric(length=10)
for (k in 2:10){
  pam <- pam(swiss, k)
  sil <- silhouette(pam$cluster, dist(swiss))
  sil_width[k] <- mean(sil[,3])
}
print(sil_width)

# k=2 maximizes silhouette width
swiss_pam <- pam(swiss, 2)
sil_2 <- silhouette(swiss_pam$cluster, dist(swiss))
mean(sil_2[, 3])

medoids <- swiss_pam$medoids
print(medoids)

mostSimilarAndMostDifferent <- function(data, mediod1, mediod2){
  max_dist <- 0
  min_dist <-200
  most_diff_col <- "Empty1"
  most_sim_col <- "Empty2"
  
  for (i in 1:6){
    diff_dist <- abs(data[mediod1, i] - data[mediod2, i])
    if (diff_dist > max_dist) {
      max_dist <- diff_dist
      most_diff_col <- colnames(swiss)[i]
    }
    else if(diff_dist < min_dist){
      min_dist <- diff_dist
      most_sim_col <- colnames(swiss)[i]
    }
  }
  result1 <- paste("Most similar column value is:", toString(most_sim_col))
  result2 <- paste("Most different column value is:", toString(most_diff_col))
  print(result1)
  print(result2)
}

mostSimilarAndMostDifferent(swiss, "Yverdon", "Monthey")
```

**With k=2, the average silhouette width is approximately 0.628. Yverdon and Monthey are mediods because they are the most representative of their respective clusters (Yverdon is representative of cluster 1 and Monthey is representative of cluster 2). They are most similar on the Infant Mortality variable and they are most different on the Catholic variable.**


### Question 3 (6 pts)

##### We used six variables here but can only really visualize data in up to three dimensions (and 2D is usually easier). To help us get a sense of the clusters, let's take the `swiss` data, add the PAM cluster assignments as a factor or character variable (e.g., using mutate; call it `cluster`), and then plot every pairwise scatterplot using the `ggpairs(cols= 1:6, aes(color=cluster))` function. Give it a second to run (it is creating a lot of plots).

#### Which variable shows the greatest difference between the two clusters? Which variable shows the least difference between the two clusters? In terms of only `Fertility`, `Agriculture`, and `Examination`, use the information in the plots to describe/characterize the two clusters.

```{R message = F}
library(GGally)
swiss1 <- swiss %>% mutate(cluster=as.factor(swiss_pam$cluster))
ggpairs(data=swiss1, cols=1:6, aes(color=cluster))
```

**The Catholic variable shows the greatest difference between the two clusters while the Infant.Mortality variable shows the least difference between the two clusters. Cluster 2 seems to have a higher median fertility rate and higher median Agriculture rate while cluster 1 seems to have a higher median Examination rate. The distribution is wider (larger range) for Fertility rate, Agriculture rate, and Examination rate for cluster 1 than cluster 2.**




```{R, echo=F}
## DO NOT DELETE THIS BLOCK!
sessionInfo()
Sys.time()
Sys.info()
```