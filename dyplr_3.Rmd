---
title: "HW 6"
author: "SDS322E"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
---

```{r global_options, include=FALSE}
#DO NOT EDIT THIS CHUNK OR ANYTHING ABOVE IT!
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, fig.align = "center", warning = F, message = F, tidy=T, tidy.opts=list(width.cutoff=50), R.options=list(max.print=100,dplyr.print_max=100))
```

## Enter your name and EID here: Callihan Bertley cjb5564

**Please submit as a knitted HTML file on Canvas before the due date.**

*For all questions, include the R commands/functions that you used to find your answer. Answers without supporting code will not receive credit.*

> **Review of how to submit this assignment**
> All homework assignments will be completed using R Markdown. These `.Rmd` files consist of text/syntax (formatted using Markdown) alongside embedded R code. 
> When you have completed the assignment (by adding R code inside codeblocks and supporting text outside of the codeblocks), create your document as follows:

> - Click the arrow next to the "Knit" button (above) 
> - Choose "Knit to HTML"
> - Go to Files pane and put checkmark next to the correct HTML file
> - Click on the blue gear icon ("More") and click Export
> - Download the file and then upload to Canvas

---

## Question 1:

##### Load the package nycflights13 with library(nycflights13). If you are not on the servers, you will need to install this package before you can use it! 

##### Run the included code chunk below to save flights and airports to your environment.

```{R}
# install.packages("nycflights13")
library(nycflights13)
library(tidyverse)

flights<-flights
airports<-airports
airlines<-airlines
glimpse(flights)
```

##### Explore the `flights` dataset (e.g., run `glimpse(flights)` read the description of each variable in the help by running `?flights`). Notice how many rows/observations there are: That's how many flights left the three big NYC airports in 2013!

### 1.1 (2 pts) 

##### Report the number and proportion of NAs for each variable using summarize_all() and/or mutate_all(). Ideally, you will write your own short function(s) to count NAs and apply it to every column via `summarize_all`, but there are other ways.

```{R}
search_NA <- function(col){
  counter_NA <- 0
  for (i in 1:length(col)){
    if (is.na(col[i])){
      counter_NA = counter_NA + 1
    }
  }
  return(counter_NA)
}

flights %>% summarize_all(search_NA)
```


### 1.2 (2 pts) 

##### Remove all rows containing NAs from the dataset (**for the rest of the assignment, we will be using only the complete rows, so overwrite the `flights` dataset or save it as a new object and use it in place of `flights` from here on out**). Now, using filter, what airport `dest` (three-letter code fine) has the longest `air_time`? 

```{R}
flights_clean <- na.omit(flights)

flights_clean %>% filter(air_time == max(air_time)) %>% select(dest, air_time)
```

**The HNL destination has the longest 'air_time'.*
------------------------------------------------------------------------

### 1.3 (4 pts) 

##### Find the mean, standard deviation, count, and standard error of `distance` in each month for each of the three different New York airports (`origin`). You will use your sd and count to find your se=sd/sqrt(count). Rename your summary variables inside of `summarize()`. 

```{R}
se <- function(col){
  return(sd(col)/sqrt(count(col)))
}

glimpse(flights_clean)
flight_data_per_month_origin <- flights_clean %>% filter(origin == 'JFK' | origin =='EWR' | origin == 'LGA') %>% group_by(month, origin) %>% summarize(
mean_air_time = mean(air_time),
sd_air_time = sd(air_time),
se_air_time = sd(air_time) / sqrt(n()))

flight_data_per_month_origin
```

### 1.4 (4 pts) 

##### Using your results from part 1.3, make a barplot of mean distance for each month using `ggplot()`. Add manual standard error bars using geom_errorbar() by specifying `aes(x=month, y=your_mean, ymin=your_mean-your_se, ymax=your_mean+your_se)`. Facet (or equivalent) by `origin` and provide labels/ticks on the x-axis for each month. Write a bit about what you see!

```{R}
ggplot(flight_data_per_month_origin, aes(month, mean_air_time, fill=origin)) + geom_bar(stat = "identity", position = 'dodge') + geom_errorbar(aes(x=month, y=mean_air_time, ymin=mean_air_time-se_air_time, ymax=mean_air_time+se_air_time)) + facet_wrap(~origin) + xlab('Month') + ylab('Mean Air Time') + labs(fill='Origin') + scale_x_continuous(breaks = 1:12, labels=1:12)
```


**La Guardia airport has the lowest standard error out of all the New York airports; JFK airport has the largest mean air time for every month by a significantly large margin. All three airports experience their highest mean air time during the holiday season.**

## Question 2 (2 pts)

Let's do some joining! The dataset `airlines` contains the full name of the carrier (examine it!). Join the dataset with the flights dataset so all of the information in `flights` is retained. Using the merged dataset, which carrier (`name`) has the longest average departure delay? Which has the shortest?

```{R}
glimpse(airlines)

flights_clean %>% left_join(airlines)

glimpse(flights_clean)

longest_avg_dep_delay_car <- flights_clean %>% filter(dep_delay == max(dep_delay)) %>% select(carrier)
shortest_avg_dep_delay_car <- flights_clean %>% filter(dep_delay == min(dep_delay)) %>% select(carrier)
answer <- paste("The airline carrier with the longest average departure delay is", longest_avg_dep_delay_car, "and the airline carrier with the shortest average departure delay is", shortest_avg_dep_delay_car)
print(answer)
```


**The airline carrier HA has the longest average departure delay while the airline carrier B6 has the shortest average departure delay**


## Question 3 


### 3.1 (4 pts) 

##### Look at the dataset called `airports`. How many rows does it have? How many unique airports (variable `faa`)? Using methods we have seen/discussed (e.g., `%in%` with `sum()` or `mean()`, set operations, joins), how many of these airports (variable `faa`) appear in the `flights` dataset as destinations (variable `dest`)? How many unique destination airports are there in the flights dataset? Which destination airports are in the `flights` dataset but missing from the `airports` dataset? Google those airport codes: what do they have in common?

```{R}
#View(airports) #1458 entries in airports
#View(flights_clean)

airports %>% distinct(faa) %>% summarize(n()) #1458 unique entries

sum(airports$faa %in% flights_clean$dest == TRUE) #100 airports(faa) appear in flights as dest

flights_clean %>% distinct(dest) %>% summarize(n()) #104 unique airports in flights_clean

airports_dist_faa <- airports %>% filter(airports$faa %in% flights_clean$dest == TRUE) %>% select(faa)
flights_clean_dist_dest <- flights_clean %>% distinct(dest)


flights_clean_dist_dest %>% filter(!(flights_clean_dist_dest$dest %in% airports_dist_faa$faa))

# All missing airports are outside the US mainland
```

**The 'airports' dataset has 1,458 rows and 1,458 distinct airports. There are 100 airports from the 'airports' dataset that are in the 'flights_clean' dataset as destinations. In the 'flights_clean' dataset, there are 104 unique airports that appear as destinations. There are 4 airports that appear in the 'flights_clean' dataset that do not appear in the 'airports' dataset: Rafael Hern√°ndez International Airport, San Juan Airport, Cyril E. King International Airport, and Mercedita International Airport; all of these airports are located outside of the US mainland.**

### 3.2 (2 pts) 

##### Do a join that results in a dataset that contains only the rows with matches (i.e., none of the airports not appearing in `flights`, none of the destinations not appearing in `airports`). Call `glimpse()` on this final dataset (please don't print the whole thing out).

```{R}
airports_matching <- airports %>% filter(airports$faa %in% flights_clean$dest)
flights_clean_matching <- flights_clean %>% filter(flights_clean$dest %in% airports$faa)
final_dataset <- inner_join(airports_matching, flights_clean_matching, by = c("faa" = "dest"))
glimpse(final_dataset)
```

```{R, echo=F}
## DO NOT DELETE THIS BLOCK!
sessionInfo()
Sys.time()
Sys.info()
```